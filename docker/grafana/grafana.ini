[server]
protocol = http
http_port = 3000
domain = admin.core-platform.local
# Root URL shown to users (with subpath)
root_url = https://%(domain)s/core-admin/monitoring
# CRITICAL: serve_from_sub_path MUST be false when Nginx strips the prefix
# Nginx rewrites /core-admin/monitoring/xyz -> /xyz before proxying to Grafana
serve_from_sub_path = false

[security]
allow_embedding = true
cookie_secure = true
cookie_samesite = none
content_security_policy = true

[auth.jwt]
enabled = true
header_name = X-Org-JWT
username_claim = sub
email_claim = email
expect_claims = {}
key_file =
jwk_set_url =
# HS256 shared secret (must match backend grafana.jwt.secret)
jwt_secret = change-me-in-production-to-secure-random-256bit-key
cache_ttl = 60m
auto_sign_up = true
role_attribute_path = role
skip_org_role_sync = false

[auth]
disable_login_form = false
oauth_auto_login = false

[auth.generic_oauth]
enabled = true
name = Keycloak
allow_sign_up = true
client_id = grafana
client_secret = grafana-secret-change-in-prod
scopes = openid profile email
auth_url = https://admin.core-platform.local/realms/admin/protocol/openid-connect/auth
token_url = https://keycloak:8443/realms/admin/protocol/openid-connect/token
api_url = https://keycloak:8443/realms/admin/protocol/openid-connect/userinfo
role_attribute_path = contains(realm_access.roles[*], 'CORE_ROLE_ADMIN') && 'Admin' || contains(realm_access.roles[*], 'CORE_ROLE_MONITORING') && 'Editor' || 'Viewer'
tls_skip_verify_insecure = true
use_pkce = true

[users]
auto_assign_org = true
auto_assign_org_role = Viewer
viewers_can_edit = false
editors_can_admin = false

[log]
mode = console
level = info

[server]
protocol = http
http_port = 3000
# Admin GUI accessible at https://admin.${DOMAIN}/monitoring
domain = admin.%(env:DOMAIN)s
root_url = %(protocol)s://%(domain)s/monitoring
serve_from_sub_path = true

[security]
# ï¿½ Disable embedding for admin GUI (use Scenes in FE instead)
allow_embedding = false
cookie_secure = true
cookie_samesite = lax
# Content Security Policy
content_security_policy = true

[auth]
# Disable login form - use OIDC only
disable_login_form = true
oauth_auto_login = true

[auth.generic_oauth]
enabled = true
name = Keycloak
allow_sign_up = false
client_id = grafana-admin
client_secret = %(env:GRAFANA_ADMIN_OIDC_SECRET)s
scopes = openid profile email groups
auth_url = https://admin.%(env:DOMAIN)s/realms/admin/protocol/openid-connect/auth
token_url = https://admin.%(env:DOMAIN)s/realms/admin/protocol/openid-connect/token
api_url = https://admin.%(env:DOMAIN)s/realms/admin/protocol/openid-connect/userinfo
# Role mapping from Keycloak groups
role_attribute_path = contains(groups[*], 'CORE_ADMIN_MONITORING') && 'Admin' || contains(groups[*], 'CORE_MONITORING_EDITOR') && 'Editor' || 'Viewer'
# Auto-assign to Main org
allowed_organizations =
login_attribute_path = preferred_username

[users]
auto_assign_org = true
auto_assign_org_role = Viewer
# Prevent users from changing their org
viewers_can_edit = false
editors_can_admin = false

[log]
mode = console
level = info

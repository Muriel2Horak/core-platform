<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Keycloak 3P Storage Test – step2</title>
    <meta name="robots" content="noindex,nofollow" />
  </head>
  <body>
    <h1>3rd‑party storage check – step2</h1>
    <div id="result">Vyhodnocuji…</div>
    <pre id="cookies"></pre>

    <script>
      function parseCookies() {
        return document.cookie.split(';').map(v => v.trim()).filter(Boolean).reduce((acc, kv) => {
          const i = kv.indexOf('=');
          const k = i > -1 ? kv.slice(0, i) : kv;
          const v = i > -1 ? decodeURIComponent(kv.slice(i + 1)) : '';
          acc[k] = v; return acc;
        }, {});
      }

      function signal(supported) {
        try { window.parent.postMessage(supported ? 'supported' : 'unsupported', '*'); } catch (e) {}
      }

      (function run(){
        const all = parseCookies();
        const supported = Boolean(all['KEYCLOAK_3P_COOKIE'] || all['KEYCLOAK_3P_COOKIE_SAMESITE']);
        document.getElementById('result').textContent = supported ? 'Podpora 3rd‑party cookies: ANO' : 'Podpora 3rd‑party cookies: NE';
        document.getElementById('cookies').textContent = 'document.cookie:\n' + document.cookie;
        signal(supported);
      })();
    </script>
  </body>
</html>

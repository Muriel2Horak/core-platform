# =============================================================================
# üîê CORE PLATFORM - ENVIRONMENT CONFIGURATION
# =============================================================================
# 
# This is the COMPLETE environment template for core-platform.
# ALL variables used in docker-compose.yml are defined here.
#
# ‚ö†Ô∏è  SECURITY:
#   - NEVER commit .env to Git (it's in .gitignore)
#   - ALWAYS use strong, unique passwords in production
#   - ROTATE credentials regularly (quarterly recommended)
#
# üìã WORKFLOW:
#   1. Copy this file: cp .env.template .env
#   2. Fill in ALL required values (marked with REQUIRED)
#   3. Validate: make env-validate
#   4. Build: make clean-fast
#
# =============================================================================
# üåê DOMAIN & NETWORK CONFIGURATION
# =============================================================================

# Primary domain for the application (REQUIRED)
# Used for: SSL certs, CORS, OAuth redirects, service URLs
# Examples: core-platform.local (dev), yourcompany.com (prod)
DOMAIN=core-platform.local

# HTTP/HTTPS ports (optional - defaults safe for dev)
HTTP_PORT=80
HTTPS_PORT=443

# =============================================================================
# üóÑÔ∏è  DATABASE CONFIGURATION
# =============================================================================

# PostgreSQL Master Credentials (REQUIRED)
# Used by: PostgreSQL container initialization
# Security: Change 'postgres' password in production!
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=postgres

# Application Database Connection (REQUIRED)
# Used by: Backend Spring Boot application
# Format: jdbc:postgresql://<host>:<port>/<database>
DATABASE_URL=jdbc:postgresql://core-db:5432/core
DATABASE_USERNAME=core
DATABASE_PASSWORD=core

# Internal Database Settings (for multi-DB setup)
DB_HOST=core-db
DB_PORT=5432
DB_INTERNAL_NAME=core
DB_INTERNAL_USERNAME=core
DB_INTERNAL_PASSWORD=core

# =============================================================================
# üîê KEYCLOAK AUTHENTICATION
# =============================================================================

# Keycloak Admin Console Credentials (REQUIRED)
# Used by: Keycloak container, Admin login
# Access: https://admin.${DOMAIN}/admin/
# ‚ö†Ô∏è  CHANGE IN PRODUCTION!
KEYCLOAK_ADMIN=admin
KEYCLOAK_ADMIN_PASSWORD=admin

# Keycloak Database Connection (REQUIRED)
# Database: 'keycloak' (created by init-multi-db.sql)
KEYCLOAK_DB_NAME=keycloak
KEYCLOAK_DB_USERNAME=core
KEYCLOAK_DB_PASSWORD=core

# Keycloak Service Account (REQUIRED)
# Used by: Backend for admin API calls (user sync, realm management)
KEYCLOAK_ADMIN_BASE_URL=http://keycloak:8080
KEYCLOAK_ADMIN_REALM=master
KEYCLOAK_ADMIN_CLIENT_ID=backend-admin-service
KEYCLOAK_ADMIN_CLIENT_SECRET=your-secure-backend-secret-key-here
KEYCLOAK_ADMIN_USERNAME=admin

# Keycloak Target Realm (REQUIRED)
# The realm where users/clients are managed
KEYCLOAK_TARGET_REALM=admin

# Keycloak Logging
KC_LOG_LEVEL=INFO

# =============================================================================
# üîë OAUTH2 / OIDC CONFIGURATION
# =============================================================================

# OIDC Issuer URI (REQUIRED)
# Used by: Backend JWT validation, OAuth2 flows
# ‚ö†Ô∏è  CRITICAL: Backend runs in Docker network and MUST use internal Keycloak URL
# Public URL (https://admin.${DOMAIN}) is NOT accessible from backend container!
# Solution: Use internal Keycloak service name with HTTPS port
OIDC_ISSUER_URI=https://keycloak:8443/realms/admin

# Backend OAuth2 Client Secret (REQUIRED)
# Used by: Backend Spring Security OAuth2 client registration
# Must match client secret in Keycloak realm
KEYCLOAK_CLIENT_SECRET=your-backend-client-secret-here

# CORS Origins (REQUIRED)
# Comma-separated list of allowed origins
# Examples: http://localhost:3000,https://*.yourcompany.com
CORS_ORIGINS=http://localhost:3000,https://*.${DOMAIN},https://${DOMAIN}

# JWT Configuration
AUTH_JWT_TENANT_CLAIM=tenant_id

# =============================================================================
# üë• MULTI-TENANCY CONFIGURATION
# =============================================================================

# Default Tenant Settings (REQUIRED)
TENANCY_DEFAULT_TENANT_KEY=admin

# Auto-Bootstrap Configuration (optional)
AUTO_BOOTSTRAP_REALM=admin
AUTO_BOOTSTRAP_TENANT_ADMIN=tenant-admin
AUTO_BOOTSTRAP_TENANT_ADMIN_PASSWORD=

# =============================================================================
# üß™ TEST USER CREDENTIALS
# =============================================================================

# Test users for E2E tests (optional for dev)
# ‚ö†Ô∏è  DISABLE in production!
TEST_USER_PASSWORD=Test.1234
TEST_ADMIN_PASSWORD=Test.1234

# =============================================================================
# üìä GRAFANA MONITORING
# =============================================================================

# Grafana Admin Credentials (REQUIRED)
# Access: https://ops.${DOMAIN}/grafana/
GRAFANA_ADMIN_PASSWORD=admin
GRAFANA_PASSWORD=admin

# Grafana Database Connection (REQUIRED)
# Database: 'grafana' (created by init-multi-db.sql)
# SECURITY: Use separate user (see DB_SEPARATE_USERS_PLAN.md)
GRAFANA_DB_NAME=grafana
GRAFANA_DB_USERNAME=core
GRAFANA_DB_PASSWORD=core

# Grafana OAuth2 Configuration (REQUIRED)
# Used by: Grafana OAuth2 Generic integration with Keycloak
# ‚ö†Ô∏è  MUST be strong random key in production!
GRAFANA_OIDC_SECRET=change-me-in-production-to-secure-random-key

# Grafana JWT Bridge (REQUIRED)
# Used by: Backend Grafana auth bridge for SSO
# ‚ö†Ô∏è  MUST be 256-bit random key in production!
GRAFANA_JWT_SECRET=change-me-in-production-to-secure-random-256bit-key
GRAFANA_JWT_TTL=300

# Grafana Public URL (auto-generated from DOMAIN)
GRAFANA_PUBLIC_URL=https://ops.${DOMAIN}/grafana

# =============================================================================
# üìà PROMETHEUS MONITORING
# =============================================================================

PROMETHEUS_PORT=9090

# =============================================================================
# üìù LOKI LOGGING
# =============================================================================

LOKI_PORT=3100

# =============================================================================
# üóÑÔ∏è  REDIS CACHE
# =============================================================================

# Redis Authentication (REQUIRED for production)
# Leave empty for dev (no auth), set strong password for prod
# ‚ö†Ô∏è  Empty = Redis runs WITHOUT authentication!
REDIS_PASSWORD=

# =============================================================================
# üì® KAFKA STREAMING
# =============================================================================

# Kafka Configuration (optional - disabled by default)
STREAMING_ENABLED=false
STREAMING_TOPIC_PREFIX=core
STREAMING_SECURITY_MODE=PLAINTEXT
# üì® KAFKA CONFIGURATION
KAFKA_SERVERS=kafka:9092                     # Used by docker-compose.yml
KAFKA_BOOTSTRAP_SERVERS=kafka:9092           # Used by Spring Boot (standard naming)

# Backend Keycloak Backfill (optional)
APP_KEYCLOAK_BACKFILL_ENABLED=true
APP_KEYCLOAK_BACKFILL_CRON="0 25 3 * * *"

# =============================================================================
# üì¶ MINIO (S3 STORAGE)
# =============================================================================

# MinIO Root Credentials (REQUIRED)
# Access: http://localhost:9001 (console)
# ‚ö†Ô∏è  CHANGE IN PRODUCTION!
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin

# =============================================================================
# üìä CUBE.JS ANALYTICS
# =============================================================================

# Cube.js API Secret (REQUIRED for production)
# Used by: Cube.js API authentication
# ‚ö†Ô∏è  CHANGE IN PRODUCTION!
CUBE_API_SECRET=dev_secret_change_in_production

# Cube.js Configuration
CUBE_PORT=4000
CUBE_DEV_MODE=true

# =============================================================================
# üõ†Ô∏è  PGADMIN (DATABASE MANAGEMENT)
# =============================================================================

# PgAdmin Credentials (optional - for database management)
# Access: http://localhost:5050
PGADMIN_EMAIL=admin@core-platform.local
PGADMIN_PASSWORD=admin

# =============================================================================
# üåç ENVIRONMENT SETTINGS
# =============================================================================

# Environment mode (development|staging|production)
ENVIRONMENT=development

# =============================================================================
# üìã VALIDATION CHECKLIST
# =============================================================================
#
# Before running 'make up', ensure ALL required variables are set:
#
# ‚úÖ Database:
#    - POSTGRES_PASSWORD (strong password)
#    - DATABASE_URL, DATABASE_PASSWORD
#    - DB_INTERNAL_PASSWORD
#
# ‚úÖ Keycloak:
#    - KEYCLOAK_ADMIN_PASSWORD (strong password)
#    - KEYCLOAK_ADMIN_CLIENT_SECRET (random UUID)
#    - KEYCLOAK_CLIENT_SECRET (random UUID)
#    - KEYCLOAK_DB_PASSWORD
#
# ‚úÖ Grafana:
#    - GRAFANA_ADMIN_PASSWORD (strong password)
#    - GRAFANA_DB_PASSWORD
#    - GRAFANA_OIDC_SECRET (256-bit random key)
#    - GRAFANA_JWT_SECRET (256-bit random key)
#
# ‚úÖ MinIO:
#    - MINIO_SECRET_KEY (strong password)
#
# ‚úÖ Cube.js:
#    - CUBE_API_SECRET (random key)
#
# ‚úÖ Optional (production):
#    - REDIS_PASSWORD (enable Redis auth)
#    - PGADMIN_PASSWORD (if using PgAdmin)
#
# üîí SECURITY TIPS:
#   - Generate secrets: openssl rand -base64 32
#   - Generate UUIDs: uuidgen | tr '[:upper:]' '[:lower:]'
#   - Rotate credentials quarterly
#   - Use separate DB users per service (see DB_SEPARATE_USERS_PLAN.md)
#
# üìñ DOCUMENTATION:
#   - Full audit: SECURITY_CONFIG_AUDIT.md
#   - DB users plan: DB_SEPARATE_USERS_PLAN.md
#   - Copilot rules: .github/copilot-instructions.md
#
# =============================================================================

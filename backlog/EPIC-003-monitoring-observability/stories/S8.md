# S8: Business Dashboards (Frontend React UI)

**EPIC:** [EPIC-003: Monitoring & Observability](../README.md)  
**Status:** ğŸ”µ **TODO**  
**Priority:** P1  
**LOC:** ~2,500 Å™Ã¡dkÅ¯ (React components + API integration)  
**Effort:** ~20 hodin

---

## ğŸ“‹ Story Description

Jako **tenant administrator**, chci **custom business dashboardy pÅ™Ã­mo v Core Platform UI (ne Grafana)**, abych **vidÄ›l pÅ™ehled aktivit, uÅ¾ivatelÅ¯, systÃ©movÃ©ho zdravÃ­ a analytiky bez nutnosti pÅ™epÃ­nat do externÃ­ho nÃ¡stroje**.

---

## ğŸ¯ Acceptance Criteria

### AC1: Tenant Overview Dashboard
- **GIVEN** jsem pÅ™ihlÃ¡Å¡en jako tenant admin
- **WHEN** otevÅ™u `/admin/monitoring/overview`
- **THEN** vidÃ­m:
  - **Top Cards (4):**
    - Active Users (today)
    - Total Documents
    - Storage Used (GB)
    - API Requests (last 24h)
  - **Charts (6):**
    - User Activity Timeline (7 days)
    - Document Creation Rate (line chart)
    - Storage Growth (area chart)
    - API Request Rate (bar chart)
    - Top Users by Activity (table)
    - Recent Events (timeline)

### AC2: User Activity Dashboard
- **GIVEN** `/admin/monitoring/users`
- **WHEN** zobrazÃ­m dashboard
- **THEN** vidÃ­m:
  - **Active Sessions** (real-time count)
  - **Login Activity** (last 24h, 7d, 30d)
  - **User Heatmap** (activity by hour/day)
  - **Top Active Users** (table)
  - **User Growth** (line chart)
  - **Session Duration** (histogram)
  - **Device/Browser Stats** (pie charts)
  - **Geographic Distribution** (worldmap)

### AC3: System Health Dashboard
- **GIVEN** `/admin/monitoring/health`
- **WHEN** zobrazÃ­m dashboard
- **THEN** vidÃ­m:
  - **Service Status** (backend, DB, Redis, Kafka - UP/DOWN)
  - **Response Times** (p50, p95, p99 - gauges)
  - **Error Rates** (last 1h - graph)
  - **Database Performance** (connections, query time)
  - **Cache Hit Rate** (Redis)
  - **Queue Lag** (Kafka consumer lag)
  - **Disk Usage** (gauge)
  - **Memory Usage** (gauge)

### AC4: Analytics Dashboard
- **GIVEN** `/admin/monitoring/analytics`
- **WHEN** zobrazÃ­m dashboard
- **THEN** vidÃ­m:
  - **Feature Usage** (top 10 features by clicks)
  - **Page Views** (most visited pages)
  - **User Journeys** (Sankey diagram)
  - **Conversion Funnels** (e.g., signup â†’ activation â†’ usage)
  - **Retention Cohorts** (cohort analysis)
  - **A/B Test Results** (if enabled)
  - **Custom Events** (tracked via analytics)

### AC5: Real-Time Updates
- **GIVEN** dashboard otevÅ™enÃ½
- **WHEN** data se mÄ›nÃ­ (novÃ½ user, dokument, request)
- **THEN** dashboard se **auto-refresh** kaÅ¾dÃ½ch 30s
- **AND** kritickÃ© metriky (errors, health) se updatujÃ­ **live** (WebSocket)

### AC6: Data Export
- **GIVEN** dashboard s daty
- **WHEN** kliknu "Export"
- **THEN** stÃ¡hnu data jako:
  - CSV (pro Excel analÃ½zu)
  - JSON (pro API integrace)
  - PDF (pro reporting)

---

## ğŸ—ï¸ Architecture

### Frontend Stack
```typescript
// Material-UI (MUI) X Charts
import { LineChart, BarChart, PieChart, Gauge } from '@mui/x-charts';

// Recharts (fallback)
import { 
  ResponsiveContainer, 
  AreaChart, 
  Heatmap 
} from 'recharts';

// Custom components
import { 
  MetricCard, 
  DashboardGrid, 
  TimeRangePicker,
  RefreshControl 
} from '@/components/monitoring';
```

### Backend API
```java
@RestController
@RequestMapping("/api/admin/monitoring/dashboards")
public class DashboardDataController {
  
  @GetMapping("/overview")
  public TenantOverviewDTO getOverview(
    @RequestParam(required = false) String timeRange
  ) {
    return dashboardService.getTenantOverview(timeRange);
  }
  
  @GetMapping("/user-activity")
  public UserActivityDTO getUserActivity(
    @RequestParam(required = false) Instant start,
    @RequestParam(required = false) Instant end
  ) {
    return dashboardService.getUserActivity(start, end);
  }
  
  @GetMapping("/system-health")
  public SystemHealthDTO getSystemHealth() {
    return dashboardService.getSystemHealth();
  }
  
  @GetMapping("/analytics")
  public AnalyticsDTO getAnalytics(
    @RequestParam String metric,
    @RequestParam String period
  ) {
    return dashboardService.getAnalytics(metric, period);
  }
}
```

### Data Sources
```yaml
Data Aggregation:
  - PostgreSQL: User data, documents, audit logs
  - Prometheus: Metrics (via /api/v1/query)
  - Loki: Log events (via /loki/api/v1/query)
  - Redis: Session data, real-time counters
  - Cube.js: Pre-aggregated analytics (S9)
```

---

## ğŸ“¦ Implementation Tasks

### T1: Dashboard Layout & Navigation (~6h, ~400 LOC)
**Objective:** VytvoÅ™it base layout a routing pro dashboardy

**Files:**
- `frontend/src/pages/admin/monitoring/DashboardLayout.tsx`
- `frontend/src/pages/admin/monitoring/OverviewDashboard.tsx`
- `frontend/src/pages/admin/monitoring/UserActivityDashboard.tsx`
- `frontend/src/pages/admin/monitoring/SystemHealthDashboard.tsx`
- `frontend/src/pages/admin/monitoring/AnalyticsDashboard.tsx`

**Components:**
```tsx
<DashboardLayout>
  <Sidebar>
    <NavItem to="/admin/monitoring/overview">Overview</NavItem>
    <NavItem to="/admin/monitoring/users">User Activity</NavItem>
    <NavItem to="/admin/monitoring/health">System Health</NavItem>
    <NavItem to="/admin/monitoring/analytics">Analytics</NavItem>
  </Sidebar>
  
  <MainContent>
    <Routes>
      <Route path="overview" element={<OverviewDashboard />} />
      <Route path="users" element={<UserActivityDashboard />} />
      <Route path="health" element={<SystemHealthDashboard />} />
      <Route path="analytics" element={<AnalyticsDashboard />} />
    </Routes>
  </MainContent>
</DashboardLayout>
```

**Acceptance:**
- Navigation mezi dashboardy funguje
- Breadcrumbs zobrazujÃ­ cestu
- Responsive layout (mobile/tablet/desktop)

---

### T2: Metric Cards & Charts Library (~8h, ~800 LOC)
**Objective:** Reusable komponenty pro metriky a grafy

**Files:**
- `frontend/src/components/monitoring/MetricCard.tsx`
- `frontend/src/components/monitoring/charts/LineChartWidget.tsx`
- `frontend/src/components/monitoring/charts/BarChartWidget.tsx`
- `frontend/src/components/monitoring/charts/PieChartWidget.tsx`
- `frontend/src/components/monitoring/charts/GaugeWidget.tsx`
- `frontend/src/components/monitoring/charts/HeatmapWidget.tsx`

**Components:**
```tsx
// MetricCard.tsx
export interface MetricCardProps {
  title: string;
  value: string | number;
  trend?: 'up' | 'down' | 'neutral';
  trendValue?: string;
  icon?: React.ReactNode;
  color?: 'primary' | 'success' | 'warning' | 'error';
}

export const MetricCard: React.FC<MetricCardProps> = ({
  title, value, trend, trendValue, icon, color
}) => (
  <Card>
    <CardContent>
      <Box display="flex" alignItems="center">
        {icon && <Avatar sx={{ bgcolor: color }}>{icon}</Avatar>}
        <Box ml={2}>
          <Typography variant="h4">{value}</Typography>
          <Typography variant="body2" color="text.secondary">
            {title}
          </Typography>
          {trend && (
            <Chip 
              label={trendValue} 
              size="small"
              color={trend === 'up' ? 'success' : 'error'}
              icon={trend === 'up' ? <TrendingUp /> : <TrendingDown />}
            />
          )}
        </Box>
      </Box>
    </CardContent>
  </Card>
);
```

**Acceptance:**
- VÅ¡echny chart typy fungujÃ­
- Responsive sizing
- Custom color schemes
- Loading states

---

### T3: Backend API Endpoints (~4h, ~600 LOC)
**Objective:** REST API pro dashboard data

**Files:**
- `backend/src/main/java/cz/muriel/core/monitoring/DashboardDataController.java`
- `backend/src/main/java/cz/muriel/core/monitoring/DashboardService.java`
- `backend/src/main/java/cz/muriel/core/monitoring/dto/TenantOverviewDTO.java`
- `backend/src/main/java/cz/muriel/core/monitoring/dto/UserActivityDTO.java`
- `backend/src/main/java/cz/muriel/core/monitoring/dto/SystemHealthDTO.java`
- `backend/src/main/java/cz/muriel/core/monitoring/dto/AnalyticsDTO.java`

**Example:**
```java
@Service
public class DashboardService {
  
  public TenantOverviewDTO getTenantOverview(String timeRange) {
    var activeUsers = userRepository.countActiveUsers(timeRange);
    var totalDocuments = documentRepository.count();
    var storageUsed = calculateStorageUsage();
    var apiRequests = prometheusClient.queryMetric(
      "sum(rate(http_requests_total[24h]))"
    );
    
    return TenantOverviewDTO.builder()
      .activeUsers(activeUsers)
      .totalDocuments(totalDocuments)
      .storageUsedGB(storageUsed)
      .apiRequests24h(apiRequests)
      .build();
  }
}
```

**Acceptance:**
- GET `/api/admin/monitoring/dashboards/overview` â†’ 200 OK
- GET `/api/admin/monitoring/dashboards/user-activity` â†’ 200 OK
- GET `/api/admin/monitoring/dashboards/system-health` â†’ 200 OK
- GET `/api/admin/monitoring/dashboards/analytics` â†’ 200 OK
- Response time < 500ms (cached queries)

---

### T4: Real-Time Updates (WebSocket) (~2h, ~200 LOC)
**Objective:** Live updates pro kritickÃ© metriky

**Files:**
- `backend/src/main/java/cz/muriel/core/monitoring/DashboardWebSocketHandler.java`
- `frontend/src/hooks/useRealtimeDashboard.ts`

**Backend:**
```java
@Component
public class DashboardWebSocketHandler extends TextWebSocketHandler {
  
  @Scheduled(fixedRate = 5000) // every 5s
  public void broadcastMetrics() {
    var health = systemHealthService.getCurrentHealth();
    var metrics = MetricsUpdateDTO.builder()
      .timestamp(Instant.now())
      .errorRate(health.getErrorRate())
      .responseTime(health.getP95ResponseTime())
      .activeUsers(sessionService.getActiveCount())
      .build();
    
    webSocketSessions.forEach(session -> 
      session.sendMessage(new TextMessage(toJson(metrics)))
    );
  }
}
```

**Frontend:**
```tsx
export const useRealtimeDashboard = (endpoint: string) => {
  const [data, setData] = useState(null);
  
  useEffect(() => {
    const ws = new WebSocket(`ws://localhost:8080${endpoint}`);
    ws.onmessage = (event) => setData(JSON.parse(event.data));
    return () => ws.close();
  }, [endpoint]);
  
  return data;
};
```

**Acceptance:**
- WebSocket connection established
- Metrics update kaÅ¾dÃ½ch 5s
- Connection auto-reconnect on disconnect

---

### T5: Data Export Functionality (~2h, ~200 LOC)
**Objective:** Export dashboard dat do CSV/JSON/PDF

**Files:**
- `frontend/src/utils/exportDashboardData.ts`
- `backend/src/main/java/cz/muriel/core/monitoring/DashboardExportController.java`

**Frontend:**
```tsx
export const exportToCSV = (data: any[], filename: string) => {
  const csv = Papa.unparse(data);
  const blob = new Blob([csv], { type: 'text/csv' });
  downloadBlob(blob, `${filename}.csv`);
};

export const exportToPDF = async (
  dashboardRef: React.RefObject<HTMLDivElement>,
  filename: string
) => {
  const canvas = await html2canvas(dashboardRef.current!);
  const pdf = new jsPDF();
  pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 0, 0, 210, 297);
  pdf.save(`${filename}.pdf`);
};
```

**Acceptance:**
- CSV export funguje
- JSON export funguje
- PDF export zachovÃ¡vÃ¡ layout

---

## ğŸ“Š Example Dashboards

### Overview Dashboard
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tenant Overview Dashboard                     ğŸ”„ Last: 30s  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚ â”‚  ğŸ‘¥ 152  â”‚ â”‚ ğŸ“„ 3,421 â”‚ â”‚ ğŸ’¾ 45GB  â”‚ â”‚ ğŸ“¡ 125K  â”‚        â”‚
â”‚ â”‚ Active   â”‚ â”‚Documents â”‚ â”‚ Storage  â”‚ â”‚ Requests â”‚        â”‚
â”‚ â”‚ Users    â”‚ â”‚          â”‚ â”‚ Used     â”‚ â”‚ (24h)    â”‚        â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ User Activity (7 days)          Document Creation Rate     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚      â•±â•²                 â”‚    â”‚     â•±â•²               â”‚   â”‚
â”‚ â”‚     â•±  â•²    â•±â•²          â”‚    â”‚  â•±â•²â•±  â•²â•±â•²           â”‚   â”‚
â”‚ â”‚    â•±    â•²  â•±  â•²         â”‚    â”‚â•±â•²          â•²         â”‚   â”‚
â”‚ â”‚   â•±      â•²â•±    â•²        â”‚    â”‚             â•²        â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Top Users by Activity              Recent Events           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ john@example.com   â”‚ 523  â”‚    â”‚ âš ï¸ Login failed       â”‚â”‚
â”‚ â”‚ jane@example.com   â”‚ 412  â”‚    â”‚ âœ… Document created   â”‚â”‚
â”‚ â”‚ bob@example.com    â”‚ 387  â”‚    â”‚ ğŸ”„ Workflow started   â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Value Proposition

### For Tenant Admins
- **Single Pane of Glass**: VÅ¡echny metriky na jednom mÃ­stÄ›
- **No Context Switching**: NenÃ­ nutnÃ© otevÃ­rat Grafana
- **Customizable**: Tailored pro business needs
- **Actionable Insights**: PÅ™ehled vedoucÃ­ k rozhodnutÃ­m

### For Platform
- **Reduced Grafana Load**: MenÅ¡Ã­ zÃ¡vislost na externÃ­m nÃ¡stroji
- **Better UX**: Integrace do core UI
- **Tenant-Specific**: AutomatickÃ¡ izolace dat per tenant
- **Export Ready**: Data pÅ™ipravenÃ¡ k dalÅ¡Ã­mu zpracovÃ¡nÃ­

---

## ğŸ“š Dependencies

- **MUI X Charts** (`@mui/x-charts`) - Pro charty
- **Recharts** (`recharts`) - Fallback charts library
- **React Query** (`@tanstack/react-query`) - Data fetching
- **html2canvas** + **jsPDF** - PDF export
- **Papa Parse** (`papaparse`) - CSV export
- **WebSocket** (native) - Real-time updates

---

**Related:** [EPIC-003 README](../README.md#s8-business-dashboards)
